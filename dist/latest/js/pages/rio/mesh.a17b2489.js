(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages/rio/mesh"],{7320:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mesh"},[e._m(0),e._v(" "),t("svg",{ref:"mesh",attrs:{id:"mesh"},on:{click:e.clicked}})])},a=[function(){var e=this,t=e._self._c;return t("header",[t("h1",[e._v("App Mesh")])])}],s=(r("fb6a"),r("b0c0"),r("a630"),r("a4d3"),r("e01a"),r("d28b"),r("2909")),o=r("1da1"),c=r("a34a"),i=r.n(c),l=(r("96cf"),r("99af"),r("4de4"),r("d3b7"),r("e260"),r("e6cf"),r("3ca3"),r("ddb0"),r("d81d"),r("ac1f"),r("5319"),r("159b"),r("2c94"));function h(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=p(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(c)throw s}}}}function p(e,t){if(e){if("string"===typeof e)return u(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var d=5,f=1e4;function m(e){return"".concat(e.namespace,":").concat(e.app,"@").concat(e.version)}function v(e){return"".concat(e.fromNamespace,":").concat(e.fromApp,"@").concat(e.fromVersion)}function g(e){return"".concat(e.toNamespace,":").concat(e.toApp,"@").concat(e.toVersion)}function b(e){return w.apply(this,arguments)}function w(){return w=Object(o["a"])(i.a.mark((function e(t){var r,n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.dispatch("rancher/request",{url:"/v1-metrics/meshsummary"});case 2:return r=e.sent,n={},r.nodes=r.nodes.filter((function(e){return!!e.app&&!!e.namespace})),r.nodes.forEach((function(e){e.id=m(e),n[e.id]=!0})),r.edges=r.edges.filter((function(e){return n[v(e)]&&n[g(e)]})),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)}))),w.apply(this,arguments)}function y(e){return e?e>100?Math.round(e):e>10?Math.round(10*e)/10:Math.round(100*e)/100:0}var x={asyncData:function(e){return Object(o["a"])(i.a.mark((function t(){var r,n;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.store,t.next=3,b(r);case 3:return n=t.sent,t.abrupt("return",n);case 5:case"end":return t.stop()}}),t)})))()},computed:{namespaces:function(){return this.$store.getters["namespaces"]()},displayNodes:function(){console.log("get displayNodes");var e=this.namespaces,t=this.nodes.filter((function(t){return e[t.namespace]}));return t},displayEdges:function(){console.log("get displayEdges");var e=this.namespaces,t=this.edges.filter((function(t){var r=t.fromNamespace,n=t.toNamespace;return e[r]&&e[n]}));return t}},watch:{nodes:function(){console.log("nodes updated"),this.updateGraph(),this.renderGraph()},namespaces:function(){console.log("namespaces updated"),this.updateGraph(),this.renderGraph()},edges:function(){console.log("edges updated"),this.updateGraph(),this.renderGraph()}},mounted:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Mounted"),e.timer=setInterval((function(){console.log("Timer"),e.refreshData()}),f),t.next=4,e.initGraph();case 4:e.updateGraph(),e.renderGraph(),window.m=e;case 7:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){clearInterval(this.timer)},methods:{refreshData:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){var r;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return console.log("Refreshing..."),t.next=3,b(e.$store);case 3:r=t.sent,e.nodes=r.nodes,e.edges=r.edges,console.log("Refreshed");case 7:case"end":return t.stop()}}),t)})))()},initGraph:function(){var e=this;return Object(o["a"])(i.a.mark((function t(){var n,a,s,o,c,l,h;return i.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.resolve().then(r.bind(null,"898b"));case 2:return n=t.sent,t.next=5,r.e("chunk-110860ca").then(r.t.bind(null,"1226",7));case 5:a=t.sent,s=new a.graphlib.Graph({compound:!0}),s.setGraph({marginx:0,marginy:0,rankdir:"LR",align:"UL",ranker:"longest-path"}),s.setDefaultEdgeLabel((function(){return{}})),o=new a.render,o.arrows().smaller=function(e,t,r,n){var s=e.append("marker").attr("id",t).attr("viewBox","0 0 12 12").attr("refX",6).attr("refY",6).attr("markerUnits","userSpaceOnUse").attr("markerWidth",12).attr("markerHeight",12).attr("orient","auto"),o=s.append("path").attr("class","arrowhead").attr("d","M 6 0 L 0 6 L 6 12 L 12 6 z").style("stroke-width",1).style("stroke-dasharray","1,0");a.util.applyStyle(o,r["".concat(n,"Style")])},c=n.select(e.$refs.mesh),l=c.append("g"),h=n.zoom().on("zoom",(function(){n.event.sourceEvent&&(e.lastZoom=n.event.transform),l.attr("transform",n.event.transform)})),c.call(h),e.d3=n,e.dagreD3=a,e.graph=s,e.render=o,e.group=l,e.zoom=h;case 21:case"end":return t.stop()}}),t)})))()},updateGraph:function(){console.log("Updating...");var e,t=l["h"],r=this.graph,n={},a=h(this.displayNodes);try{for(a.s();!(e=a.n()).done;){var o=e.value,c=j(o.namespace),i=m(o);o.label="".concat(o.app,"@").concat(o.version);var p=o.stats.p99ms,u="ms";p>1e3&&(p/=1e3,u="s");var f='\n          <div class="version">\n            <h4>'.concat(t(o.app),"@").concat(t(o.version),'</h4>\n            <div class="row">\n              <div class="col span-4 sr">\n                <span>').concat(y(100*o.stats.successRate),'</span><span class="unit">%</span>\n              </div>\n              <div class="col span-4 rps">\n                <span>').concat(y(o.stats.rps),'</span>\n              </div>\n              <div class="col span-4 p99">\n                <span>').concat(y(p),'</span><span class="unit">').concat(u,"</span>\n              </div>\n            </div>\n          </div>\n        ");r.setNode(i,{labelType:"html",label:f,width:158,height:80,rx:d,ry:d}),r.setParent(i,c)}}catch(z){a.e(z)}finally{a.f()}var b,w=this.displayEdges.map((function(e){return e.stats.rps})),x=Math.min.apply(Math,Object(s["a"])(w)),k=Math.max.apply(Math,Object(s["a"])(w)),M=h(this.displayEdges);try{for(M.s();!(b=M.n()).done;){var G=b.value;j(G.fromNamespace),j(G.toNamespace);var N=Math.floor(4*(G.stats.rps-x)/(k-x))+1;r.setEdge(v(G),g(G),{arrowhead:"smaller",arrowheadClass:"arrowhead",class:"weight".concat(N),curve:this.d3.curveBasis,weight:N})}}catch(z){M.e(z)}finally{M.f()}function j(e){var t="ns:".concat(e);return n[e]||(n[e]=!0,r.setNode(t,{label:"Namespace: ".concat(e),clusterLabelPos:"top",rx:d,ry:d})),t}},renderGraph:function(){console.log("Rendering...");var e=this.d3,t=this.d3.select(this.$refs.mesh),r=this.group,n=this.graph,a=this.render,s=this.zoom;t.call(s.transform,e.zoomIdentity.translate(0,0).scale(1)),a(r,n);var o=n.graph().width,c=n.graph().height,i=parseInt(t.style("width").replace(/px/,"")),l=parseInt(t.style("height").replace(/px/,"")),h=Math.min(i/o,l/c),p=i/2-o*h/2,u=l/2-c*h/2;console.log("render"),this.lastZoom?t.call(s.transform,e.zoomIdentity.translate(this.lastZoom.x,this.lastZoom.y).scale(this.lastZoom.k)):t.call(s.transform,e.zoomIdentity.translate(p,u).scale(h)),this.loading=!1},clicked:function(e){var t=e.target.closest(".edgePath");console.log(t)}}},k=x,M=(r("7a3d"),r("0c7c")),G=Object(M["a"])(k,n,a,!1,null,null,null);t["default"]=G.exports},"7a3d":function(e,t,r){"use strict";r("f381")},af9b:function(e,t,r){var n=r("4bad");t=n(!1),t.push([e.i,'#mesh{width:100%;height:calc(100vh - 165px)}#mesh .version{width:158px;height:80px;color:#b6b6c2;text-align:center}#mesh .version .row{margin:0}#mesh .version H4{color:#b6b6c2;display:block;border-bottom:1px solid #555;text-align:left;padding-bottom:5px;margin-bottom:5px}#mesh .version .p99,#mesh .version .rps,#mesh .version .sr{font-size:20px}#mesh .version .p99 .unit,#mesh .version .rps .unit,#mesh .version .sr .unit{font-size:12px}#mesh .version .p99:before,#mesh .version .rps:before,#mesh .version .sr:before{color:#fff;font-weight:700;font-size:15px;display:block}#mesh .version .sr:before{content:"SR"}#mesh .version .rps:before{content:"RPS"}#mesh .version .p99:before{content:"99%"}#mesh .clusters .label text{fill:#b6b6c2;font-weight:700}#mesh .clusters RECT{fill:#222;stroke:#555}#mesh .arrowhead{fill:#6c6c76}#mesh .node RECT{fill:#111;stroke:#555}#mesh PATH{stroke:#6c6c76}#mesh .edgePath{cursor:pointer}#mesh .weight1{stroke-width:2px}#mesh .weight2{stroke-width:3px}#mesh .weight3{stroke-width:4px}#mesh .weight4{stroke-width:5px}#mesh .weight5{stroke-width:6px}',""]),e.exports=t},f381:function(e,t,r){var n=r("af9b");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var a=r("499e").default;a("3121da1e",n,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=mesh.a17b2489.js.map