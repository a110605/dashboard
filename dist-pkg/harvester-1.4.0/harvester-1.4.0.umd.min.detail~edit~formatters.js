(("undefined"!==typeof self?self:this)["webpackJsonpharvester_1_4_0"]=("undefined"!==typeof self?self:this)["webpackJsonpharvester_1_4_0"]||[]).push([[0],{"2c0b":function(e,t,s){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",[e.arbitrary?t("div",[e.value?t("BadgeState",{attrs:{color:e.stateBackground,label:e.stateDisplay}}):e._e()],1):t("BadgeState",{attrs:{value:e.row}})],1)},a=[],n=s("57ab"),o=s("35ef"),r={components:{BadgeState:n["a"]},props:{value:{type:String,default:""},row:{type:Object,required:!0},col:{type:Object,default:()=>{}},arbitrary:{type:Boolean,default:!1}},data(){return{stateDisplay:"",stateBackground:""}},watch:{value:{handler(){if(this.arbitrary){const e=Object(o["d"])(this.value);this.stateDisplay=Object(o["f"])(this.value),this.stateBackground=e.replace("text-","bg-")}},immediate:!0}}},l=r,d=s("d802"),c=Object(d["a"])(l,i,a,!1,null,null,null);t["a"]=c.exports},"4b06":function(e,t,s){"use strict";s.d(t,"a",(function(){return p})),s.d(t,"b",(function(){return g}));var i=s("e3b5"),a=s("7838"),n=s.n(a),o=s("9e74"),r=s.n(o),l=s("1832"),d=s("56a4"),c=s("90cd"),u=s("873f"),h=s("6834"),m=s("de15");const p={package_update:!0,packages:["qemu-guest-agent"],runcmd:[["systemctl","enable","--now","qemu-guest-agent.service"]]},v={default:"qemu-guest-agent.service"},g=[{bus:"usb",name:"tablet",type:"tablet"}],f={EXISTING_ALL:"EXISTING_ALL",EXISTING_ONLY_ANNOTATION:"EXISTING_ANNOTATION",EXISTING_ONLY_CLOUD:"EXISTING_CLOUD"};t["c"]={methods:{hasCloudConfigComment(e){var t,s,a;const n=e?i["a"].parseDocument(e):i["a"].parseDocument({}),o=(null===n||void 0===n||null===(t=n.contents)||void 0===t?void 0:t.items)||[];let r=!1;return("cloud-config"===(null===n||void 0===n?void 0:n.comment)||null!==n&&void 0!==n&&null!==(s=n.comment)&&void 0!==s&&s.includes("cloud-config\n"))&&(r=!0),("cloud-config"===(null===n||void 0===n?void 0:n.commentBefore)||null!==n&&void 0!==n&&null!==(a=n.commentBefore)&&void 0!==a&&a.includes("cloud-config\n"))&&(r=!0),o.map(e=>{var t;const s=e.key;("cloud-config"===(null===s||void 0===s?void 0:s.commentBefore)||null!==s&&void 0!==s&&null!==(t=s.commentBefore)&&void 0!==t&&t.includes("cloud-config\n"))&&(r=!0)}),r},getSSHValue(e){var t,s;const i=this.$store.getters["currentProduct"].inStore,a=this.$store.getters[i+"/all"](c["b"].SSH)||[];return(null===(t=a.find(t=>t.id===e))||void 0===t||null===(s=t.spec)||void 0===s?void 0:s.publicKey)||void 0},getOsType(e){var t,s;return null===(t=e.metadata)||void 0===t||null===(s=t.labels)||void 0===s?void 0:s[u["a"].OS]},getMatchQGA(e){const t=Object(l["e"])(p);let s=!1;return h["b"].forEach(t=>{t.match&&(s=t.match.find(t=>t===e))}),t.runcmd[0][3]=s?v[e]:v["default"],t},getSimilarRuncmd(e){const t=Object(l["e"])(p);return t.runcmd[0][3]="openSUSE"===e?v["default"]:v["suse"],t.runcmd[0]},hasInstallAgent(e,t,s){var i,a,o,r;let l={};const d=this.getMatchQGA(t);try{l=n.a.load(e)||{}}catch(c){return new Error("Function(hasInstallAgent) error"),s}return(null===(i=l)||void 0===i||null===(a=i.packages)||void 0===a?void 0:a.includes("qemu-guest-agent"))&&!(null===(o=l)||void 0===o||null===(r=o.runcmd)||void 0===r||!r.find(e=>Array.isArray(e)&&e.join("-")===d.runcmd[0].join("-")))},isInstallUSBTablet(e){var t,s,i,a;const n=null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.domain)||void 0===i||null===(a=i.devices)||void 0===a?void 0:a.inputs;return!!Array.isArray(n)&&!!n.find(e=>r()(e,g[0]))},isEfiEnabled(e){var t,s,i,a,n;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.domain)||void 0===i||null===(a=i.firmware)||void 0===a||null===(n=a.bootloader)||void 0===n||!n.efi)},isTpmEnabled(e){var t,s,i,a;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.domain)||void 0===i||null===(a=i.devices)||void 0===a||!a.tpm)},isSecureBoot(e){var t,s,i,a,n,o;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.domain)||void 0===i||null===(a=i.firmware)||void 0===a||null===(n=a.bootloader)||void 0===n||null===(o=n.efi)||void 0===o||!o.secureBoot)},isCpuPinning(e){var t,s,i,a;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.domain)||void 0===i||null===(a=i.cpu)||void 0===a||!a.dedicatedCpuPlacement)},getCloudInitNoCloud(e){var t,s,i,a,n,o;const r=this.getSecret(e);let l=null===r||void 0===r||null===(t=r.decodedData)||void 0===t?void 0:t.userdata,d=null===r||void 0===r||null===(s=r.decodedData)||void 0===s?void 0:s.networkdata;const c=(null===e||void 0===e||null===(i=e.template)||void 0===i||null===(a=i.spec)||void 0===a||null===(n=a.volumes)||void 0===n||null===(o=n.find(e=>"cloudinitdisk"===e.name))||void 0===o?void 0:o.cloudInitNoCloud)||{};return null!==c&&void 0!==c&&c.userData&&(l=c.userData,this.saveUserDataAsClearText=!0),null!==c&&void 0!==c&&c.networkData&&(d=c.networkData,this.saveNetworkDataAsClearText=!0),{userData:l,networkData:d}},getSecret(e){var t,s,i,a,n,o;const r=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s||null===(i=s.volumes)||void 0===i||null===(a=i.find(e=>"cloudinitdisk"===e.name))||void 0===a?void 0:a.cloudInitNoCloud)||{},l=this.$store.getters["currentProduct"].inStore,c=this.$store.getters[l+"/all"](d["K"])||[],u=(null===r||void 0===r||null===(n=r.secretRef)||void 0===n?void 0:n.name)||(null===r||void 0===r||null===(o=r.networkDataSecretRef)||void 0===o?void 0:o.name),h=c.find(e=>e.metadata.name===u);return h},getAccessCredentials(e){var t,s,i,a;const n=this.$store.getters["currentProduct"].inStore,o=this.$store.getters[n+"/all"](d["K"])||[],r=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.spec)||void 0===s?void 0:s.accessCredentials)||[],l=JSON.parse((null===(i=e.template.metadata)||void 0===i||null===(a=i.annotations)||void 0===a?void 0:a[u["a"].DYNAMIC_SSHKEYS_NAMES])||"[]");return r.map(e=>{var t,s,i;const a=e.userPassword?"userPassword":"sshPublicKey",n=null===(t=e[a])||void 0===t||null===(s=t.source)||void 0===s||null===(i=s.secret)||void 0===i?void 0:i.secretName,r=o.find(e=>e.metadata.name===n),d={source:a,username:"",newPassword:"",users:[],sshkeys:[],secretName:n,secretRef:r};if(r)if("userPassword"===a){const e=Object.keys(null===r||void 0===r?void 0:r.data)[0],t=r.decodedData[e];d.username=e,d.newPassword=t}else{const t=e[a].propagationMethod.qemuGuestAgent.users,s=null===l||void 0===l?void 0:l[n];d.users=t,d.sshkeys=s}else d.secretRef=void 0;return d})},getRootImageId(e){var t,s,i;const a=Object(m["a"])(e);return(null===a||void 0===a||null===(t=a[0])||void 0===t||null===(s=t.metadata)||void 0===s||null===(i=s.annotations)||void 0===i?void 0:i[u["a"].IMAGE_ID])||""},getSSHFromAnnotation(e){var t,s,i;const a=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.metadata)||void 0===s||null===(i=s.annotations)||void 0===i?void 0:i[u["a"].SSH_NAMES])||"[]";return JSON.parse(a)},convertToJson(e=""){let t={};try{t=n.a.load(e)}catch(s){new Error("Function(convertToJson) error")}return t},getSSHFromUserData(e){var t;return(null===(t=this.convertToJson(e))||void 0===t?void 0:t.ssh_authorized_keys)||[]},compareSSHValue(e="",t=""){const s=/(\r\n\t|\n|\r\t)|(\s*)/gm;return e.replace(s,"")===t.replace(s,"")},mergeAllSSHs(e){const t=this.getSSHFromAnnotation(e),{userScript:s}=this.getCloudInitNoCloud(e);if(!(null!==t&&void 0!==t&&t.length)<0&&!s)return[];let i=[];const a=this.$store.getters["currentProduct"].inStore,n=this.$store.getters[a+"/all"](c["b"].SSH)||[];i=(t||[]).map(e=>{const t=n.find(t=>t.id===e);return t?{id:t.id,data:t,type:f.EXISTING_ALL}:{id:e,data:e,type:f.EXISTING_ONLY_ANNOTATION}});const o=this.getSSHFromUserData(s);return o.map(e=>{const t=n.find(t=>{var s;return this.compareSSHValue(e,null===(s=t.spec)||void 0===s?void 0:s.publicKey)});t&&!i.find(e=>e.id===t.id)?i.push({id:t.id,data:t,type:f.EXISTING_ALL}):t||i.push({id:"Unknown",data:e,type:f.EXISTING_ONLY_CLOUD})}),i}}}},6834:function(e,t,s){"use strict";s.d(t,"a",(function(){return w})),s.d(t,"b",(function(){return $}));var i=s("e3b5"),a=s("7838"),n=s.n(a),o=s("9e74"),r=s.n(o),l=s("330a"),d=s.n(l),c=s("94a3"),u=s.n(c),h=s("7592"),m=s("1832"),p=s("b837"),v=s("06f6"),g=s("8672"),f=s("67ab"),S=s("7c47"),y=s("d6a6"),b=s("56a4"),A=s("90cd"),N=s("fa85"),E=s("b0bd"),I=s("873f"),T=s("4b06"),k=s("e411"),M=s("de15");const C="longhorn-system/v2-data-engine",w="management Network",$=[{label:"Windows",value:"windows"},{label:"Linux",value:"linux"},{label:"SUSE Linux Enterprise",value:"SLEs"},{label:"Debian",value:"debian"},{label:"Fedora",value:"fedora"},{label:"Gentoo",value:"gentoo"},{label:"Oracle",value:"oracle"},{label:"Red Hat",match:["redhat","rhel"],value:"redhat"},{label:"openSUSE",value:"openSUSE"},{label:"Ubuntu",value:"ubuntu"},{label:"Other Linux",match:["centos"],value:"otherLinux"}],O="cd-rom",D="disk";t["c"]={mixins:[T["c"]],props:{value:{type:Object,required:!0},resource:{type:String,default:""}},async fetch(){const e=this.$store.getters["currentProduct"].inStore,t={pvs:this.$store.dispatch(e+"/findAll",{type:b["E"]}),pvcs:this.$store.dispatch(e+"/findAll",{type:b["F"]}),storageClasses:this.$store.dispatch(e+"/findAll",{type:b["P"]}),sshs:this.$store.dispatch(e+"/findAll",{type:A["b"].SSH}),settings:this.$store.dispatch(e+"/findAll",{type:A["b"].SETTING}),images:this.$store.dispatch(e+"/findAll",{type:A["b"].IMAGE}),versions:this.$store.dispatch(e+"/findAll",{type:A["b"].VM_VERSION}),templates:this.$store.dispatch(e+"/findAll",{type:A["b"].VM_TEMPLATE}),networkAttachment:this.$store.dispatch(e+"/findAll",{type:b["y"]}),vmis:this.$store.dispatch(e+"/findAll",{type:A["b"].VMI}),vmims:this.$store.dispatch(e+"/findAll",{type:A["b"].VMIM}),vms:this.$store.dispatch(e+"/findAll",{type:A["b"].VM}),secrets:this.$store.dispatch(e+"/findAll",{type:b["K"]}),addons:this.$store.dispatch(e+"/findAll",{type:A["b"].ADD_ONS}),longhornV2Engine:this.$store.dispatch(e+"/find",{type:b["t"].SETTINGS,id:C})};this.$store.getters[e+"/schemaFor"](b["A"])&&(t.nodes=this.$store.dispatch(e+"/findAll",{type:b["A"]})),this.$store.getters[e+"/schemaFor"](A["b"].CLUSTER_NETWORK)&&(t.clusterNetworks=this.$store.dispatch(e+"/findAll",{type:A["b"].CLUSTER_NETWORK})),this.$store.getters[e+"/schemaFor"](A["b"].VLAN_CONFIG)&&(t.clusterNetworks=this.$store.dispatch(e+"/findAll",{type:A["b"].VLAN_CONFIG})),this.$store.getters[e+"/schemaFor"](b["t"].VOLUMES)&&(t.longhornVolumes=this.$store.dispatch(e+"/findAll",{type:b["t"].VOLUMES}));const s=await Object(p["a"])(t),i=!!this.$store.getters[e+"/schemaFor"](A["b"].PCI_DEVICE),a=!!this.$store.getters[e+"/schemaFor"](A["b"].SR_IOVGPU_DEVICE),n=s.addons.reduce((e,t)=>{var s;return{...e,[t.name]:null===(s=t.spec)||void 0===s?void 0:s.enabled}},{});this.enabledPCI=i&&n[S["b"].PCI_DEVICE_CONTROLLER],this.enabledSriovgpu=a&&n[S["b"].PCI_DEVICE_CONTROLLER]&&n[S["b"].NVIDIA_DRIVER_TOOLKIT_CONTROLLER]},data(){const e=this.realMode===y["w"];return{OS:$,isClone:e,spec:null,osType:"linux",sshKey:[],maintenanceStrategies:S["i"],maintenanceStrategy:"Migrate",runStrategies:S["j"],runStrategy:"RerunOnFailure",installAgent:!0,hasCreateVolumes:[],installUSBTablet:!0,networkScript:"",userScript:"",imageId:"",diskRows:[],networkRows:[],machineType:"",secretName:"",secretRef:null,showAdvanced:!1,deleteAgent:!0,memory:null,cpu:"",reservedMemory:null,accessCredentials:[],efiEnabled:!1,tpmEnabled:!1,secureBoot:!1,userDataTemplateId:"",saveUserDataAsClearText:!1,saveNetworkDataAsClearText:!1,enabledPCI:!1,enabledSriovgpu:!1,immutableMode:this.realMode===y["y"]?y["y"]:y["H"],terminationGracePeriodSeconds:"",cpuPinning:!1}},computed:{inStore(){return this.$store.getters["currentProduct"].inStore},images(){return this.$store.getters[this.inStore+"/all"](A["b"].IMAGE)},versions(){return this.$store.getters[this.inStore+"/all"](A["b"].VM_VERSION)},templates(){return this.$store.getters[this.inStore+"/all"](A["b"].VM_TEMPLATE)},pvcs(){return this.$store.getters[this.inStore+"/all"](b["F"])},secrets(){return this.$store.getters[this.inStore+"/all"](b["K"])},filteredNamespaces(){return this.$store.getters["harvester/all"](b["x"]).filter(e=>!e.isSystem)},nodes(){return this.$store.getters["harvester/all"](b["A"])},nodesIdOptions(){const e=this.$store.getters[this.inStore+"/all"](b["A"]),t=this.networkRows.map(e=>e.networkName),s=this.$store.getters[this.inStore+"/all"](b["y"]),i=t.map(e=>s.find(t=>t.id===e)).filter(e=>null===e||void 0===e?void 0:e.id),a=Object(k["m"])(i.map(e=>{var t;return null===(t=e.clusterNetworkResource)||void 0===t?void 0:t.id}));return e.filter(e=>!e.isUnSchedulable).map(e=>{const t=[];let s=!0;return a.length>0&&a.map(e=>{t.push("network.harvesterhci.io/"+e)}),t.map(t=>{var i,a;"true"!==(null===(i=e.metadata)||void 0===i||null===(a=i.labels)||void 0===a?void 0:a[t])&&(s=!1)}),{label:s?e.nameDisplay:`${e.nameDisplay} (${this.t("harvester.virtualMachine.scheduling.networkNotSupport")})`,value:e.id,disabled:!s}})},defaultStorageClass(){const e=this.$store.getters[this.inStore+"/all"](b["P"]).find(e=>e.isDefault);return e},storageClassSetting(){try{var e;const t=null===(e=this.$store.getters[this.inStore+"/all"](A["b"].SETTING).find(e=>e.id===N["b"].DEFAULT_STORAGE_CLASS))||void 0===e?void 0:e.value;return JSON.parse(t)}catch(t){return{}}},customVolumeMode(){return this.storageClassSetting.volumeMode||"Block"},customAccessMode(){return this.storageClassSetting.accessModes||"ReadWriteMany"},isWindows(){return"windows"===this.osType},needNewSecret(){return this.resource===A["b"].VM_VERSION||this.isCreate},defaultTerminationSetting(){const e=this.$store.getters[this.inStore+"/all"](A["b"].SETTING).find(e=>e.id===N["b"].VM_TERMINATION_PERIOD)||{};return Number((null===e||void 0===e?void 0:e.value)||(null===e||void 0===e?void 0:e.default))},affinityLabels(){return{namespaceInputLabel:this.t("harvesterManager.affinity.namespaces.label"),namespaceSelectionLabels:[this.t("harvesterManager.affinity.thisPodNamespace"),this.t("workload.scheduling.affinity.allNamespaces"),this.t("harvesterManager.affinity.matchExpressions.inNamespaces")],addLabel:this.t("harvesterManager.affinity.addLabel"),topologyKeyPlaceholder:this.t("harvesterManager.affinity.topologyKey.placeholder")}}},async created(){await this.$store.dispatch(this.inStore+"/findAll",{type:b["K"]}),this.getInitConfig({value:this.value,init:this.isCreate})},methods:{getInitConfig(e){var t,s,i,a,n,o,r,l,d,c;const{value:u,existUserData:h,fromTemplate:m=!1,init:p=!1}=e,v=this.resource===A["b"].VM?u:this.resource===A["b"].BACKUP?null===(t=this.value.status)||void 0===t?void 0:t.source:u.spec.vm,f=this.resource===A["b"].BACKUP?null===(s=this.value.status)||void 0===s?void 0:s.volumeBackups:null,S=null===v||void 0===v?void 0:v.spec;if(!S)return;const y=S.template.spec.domain.resources;null!==y&&void 0!==y&&y.limits&&(null===y||void 0===y||!y.limits||null!==y&&void 0!==y&&null!==(i=y.limits)&&void 0!==i&&i.memory||null===(null===y||void 0===y||null===(a=y.limits)||void 0===a?void 0:a.memory))||(S.template.spec.domain.resources={...S.template.spec.domain.resources,limits:{...S.template.spec.domain.resources.limits,memory:S.template.spec.domain.resources.requests.memory}}),v.metadata.labels||(v.metadata.labels={});const b=(null===(n=v.metadata.labels)||void 0===n?void 0:n[I["a"].VM_MAINTENANCE_MODE_STRATEGY])||"Migrate",N=S.runStrategy||"RerunOnFailure",E=u.machineType,T=null===(o=S.template.spec.domain)||void 0===o||null===(r=o.cpu)||void 0===r?void 0:r.cores,k=S.template.spec.domain.resources.limits.memory,M=null===(l=v.metadata)||void 0===l||null===(d=l.annotations)||void 0===d?void 0:d[I["a"].VM_RESERVED_MEMORY],C=(null===(c=S.template.spec)||void 0===c?void 0:c.terminationGracePeriodSeconds)||this.defaultTerminationSetting,w=this.getSSHFromAnnotation(S)||[],$=this.getRootImageId(v)||"",O=this.getDiskRows(v,f),D=this.getNetworkRows(v,{fromTemplate:m,init:p}),_=this.getHasCreatedVolumes(S)||[];let{userData:R,networkData:V}=this.getCloudInitNoCloud(S);if(this.resource===A["b"].BACKUP){var P;const e=null===(P=this.value.status)||void 0===P?void 0:P.secretBackups;if(e){var L,G,U,B;const t=(null===(L=e[0])||void 0===L||null===(G=L.data)||void 0===G?void 0:G.networkdata)||"",s=(null===(U=e[0])||void 0===U||null===(B=U.data)||void 0===B?void 0:B.userdata)||"";R=Object(g["a"])(s),V=Object(g["a"])(t)}}const j=this.getOsType(v)||"linux";R=!this.isCreate||h||this.isClone?R:this.getInitUserData({osType:j});const H=this.isInstallUSBTablet(S),x=this.hasInstallAgent(R,j,!0),K=this.isEfiEnabled(S),F=this.isTpmEnabled(S),Y=this.isSecureBoot(S),q=this.isCpuPinning(S),J=this.getSecret(S),z=this.getAccessCredentials(S);Object.prototype.hasOwnProperty.call(S,"running")&&(delete S.running,S.runStrategy="RerunOnFailure"),this.$set(this,"spec",S),this.$set(this,"maintenanceStrategy",b),this.$set(this,"runStrategy",N),this.$set(this,"secretRef",J),this.$set(this,"accessCredentials",z),this.$set(this,"userScript",R),this.$set(this,"networkScript",V),this.$set(this,"sshKey",w),this.$set(this,"osType",j),this.$set(this,"installAgent",x),this.$set(this,"cpu",T),this.$set(this,"memory",k),this.$set(this,"reservedMemory",M),this.$set(this,"machineType",E),this.$set(this,"terminationGracePeriodSeconds",C),this.$set(this,"installUSBTablet",H),this.$set(this,"efiEnabled",K),this.$set(this,"tpmEnabled",F),this.$set(this,"secureBoot",Y),this.$set(this,"cpuPinning",q),this.$set(this,"hasCreateVolumes",_),this.$set(this,"networkRows",D),this.$set(this,"imageId",$),this.$set(this,"diskRows",O),this.refreshYamlEditor()},getDiskRows(e,t){const s=e.metadata.namespace,i=e.spec.template.spec.volumes||[],a=e.spec.template.spec.domain.devices.disks||[],n=Object(M["a"])(e);let o=[];if(0===a.length){var r,l;let e="virtio",s=D,i="10Gi";const a=this.images.find(e=>this.imageId===e.id),n=/iso$/i.test(null===a||void 0===a?void 0:a.imageSuffix),d=Math.max(null===a||void 0===a||null===(r=a.status)||void 0===r?void 0:r.size,null===a||void 0===a||null===(l=a.status)||void 0===l?void 0:l.virtualSize),c=(null===a||void 0===a?void 0:a.isEncrypted)||!1,u=(null===t||void 0===t?void 0:t.find(e=>"disk-0"===e.volumeName))||null;if(n&&(e="sata",s=O),d){let e=Math.ceil(d/1024/1024/1024);n||(e=Math.max(e,10)),i=e+"Gi"}o.push({id:Object(v["p"])(5),source:S["f"].IMAGE,name:"disk-0",accessMode:"ReadWriteMany",bus:e,volumeName:"",size:i,type:s,storageClassName:"",image:this.imageId,volumeMode:"Block",isEncrypted:c,volumeBackups:u})}else o=a.map((e,a)=>{var o,r,l,d,c,u;const h=i.find(t=>t.name===e.name);let m="",p="",g="",y="",A="",N="",E="",T="",k="",M=!1,C=null;const w=null!==e&&void 0!==e&&e.cdrom?O:null!==e&&void 0!==e&&e.disk?D:"";if(null!==h&&void 0!==h&&h.containerDisk&&(g=S["f"].CONTAINER,A=h.containerDisk.image),h.persistentVolumeClaim&&null!==(o=h.persistentVolumeClaim)&&void 0!==o&&o.claimName){N=h.persistentVolumeClaim.claimName;const e=n.find(e=>e.metadata.name===N);if(y=N,e){var $,_,R,V,P,L,G;if(void 0!==(null===($=e.metadata)||void 0===$||null===(_=$.annotations)||void 0===_?void 0:_[I["a"].IMAGE_ID]))p=null===(L=e.metadata)||void 0===L||null===(G=L.annotations)||void 0===G?void 0:G[I["a"].IMAGE_ID],g=S["f"].IMAGE;else g=S["f"].NEW;const t=(null===e||void 0===e?void 0:e.spec)||{};T=null===t||void 0===t?void 0:t.volumeMode,E=null===t||void 0===t||null===(R=t.accessModes)||void 0===R?void 0:R[0],m=(null===t||void 0===t||null===(V=t.resources)||void 0===V||null===(P=V.requests)||void 0===P?void 0:P.storage)||"10Gi",k=null===t||void 0===t?void 0:t.storageClassName,C=null===t||void 0===t?void 0:t.dataSource}else{var U,B,j,H,x,K,F,Y;const e=this.$store.getters["harvester/all"](b["F"]),t=e.find(e=>{var t;return e.id===`${s}/${null===h||void 0===h||null===(t=h.persistentVolumeClaim)||void 0===t?void 0:t.claimName}`});g=S["f"].ATTACH_VOLUME,E=(null===t||void 0===t||null===(U=t.spec)||void 0===U||null===(B=U.accessModes)||void 0===B?void 0:B[0])||"ReadWriteMany",m=(null===t||void 0===t||null===(j=t.spec)||void 0===j||null===(H=j.resources)||void 0===H||null===(x=H.requests)||void 0===x?void 0:x.storage)||"10Gi",k=null===t||void 0===t||null===(K=t.spec)||void 0===K?void 0:K.storageClassName,T=(null===t||void 0===t||null===(F=t.spec)||void 0===F?void 0:F.volumeMode)||"Block",N=(null===t||void 0===t||null===(Y=t.metadata)||void 0===Y?void 0:Y.name)||""}M=h.persistentVolumeClaim.hotpluggable||!1}const q=(null===e||void 0===e||null===(r=e.disk)||void 0===r?void 0:r.bus)||(null===e||void 0===e||null===(l=e.cdrom)||void 0===l?void 0:l.bus),J=null!==e&&void 0!==e&&e.bootOrder?null===e||void 0===e?void 0:e.bootOrder:a,z=Object(f["f"])(m),W=Object(f["e"])(z,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3}),X=this.pvcs.find(e=>e.id===`${this.value.metadata.namespace}/${N}`),Q=null===X||void 0===X||null===(d=X.relatedPV)||void 0===d||null===(c=d.metadata)||void 0===c||null===(u=c.annotations)||void 0===u?void 0:u[I["a"].VOLUME_ERROR],Z=(null===X||void 0===X?void 0:X.isEncrypted)||!1,ee=(null===t||void 0===t?void 0:t.find(t=>t.volumeName===e.name))||null;return{id:Object(v["p"])(5),bootOrder:J,source:g,name:e.name,realName:y,bus:q,volumeName:N,container:A,accessMode:E,size:W+"Gi",volumeMode:T||this.customVolumeMode,image:p,type:w,storageClassName:k,hotpluggable:M,volumeStatus:Q,dataSource:C,namespace:s,isEncrypted:Z,volumeBackups:ee}});return o=Object(h["b"])(o,"bootOrder"),o.filter(e=>"cloudinitdisk"!==e.name)},getNetworkRows(e,t){const{fromTemplate:s=!1,init:i=!1}=t,a=e.spec.template.spec.networks||[],n=e.spec.template.spec.domain.devices.interfaces||[],o=n.map((e,t)=>{var n;const o=a.find(t=>e.name===t.name),r=e.sriov?"sriov":e.bridge?"bridge":"masquerade",l=!!o.pod;return{...e,index:t,type:r,isPod:l,newCreateId:!(!s&&!i)&&Object(v["p"])(10),model:e.model,networkName:l?w:null===o||void 0===o||null===(n=o.multus)||void 0===n?void 0:n.networkName}});return o},parseVM(){this.userData=this.getUserData({osType:this.osType,installAgent:this.installAgent}),this.parseOther(),this.parseAccessCredentials(),this.parseNetworkRows(this.networkRows),this.parseDiskRows(this.diskRows)},parseOther(){this.spec.template.spec.domain.machine?this.$set(this.spec.template.spec.domain.machine,"type",this.machineType):this.$set(this.spec.template.spec.domain,"machine",{type:this.machineType}),this.spec.template.spec.domain.cpu.cores=this.cpu,this.spec.template.spec.domain.resources.limits.cpu=this.cpu?this.cpu.toString():this.cpu,this.spec.template.spec.domain.resources.limits.memory=this.memory,this.spec.template.spec.terminationGracePeriodSeconds=this.terminationGracePeriodSeconds;const e=this.resource===A["b"].VM?this.value:this.value.spec.vm;this.reservedMemory?e.metadata.annotations[I["a"].VM_RESERVED_MEMORY]=this.reservedMemory:delete e.metadata.annotations[I["a"].VM_RESERVED_MEMORY],"Migrate"===this.maintenanceStrategy?delete e.metadata.labels[I["a"].VM_MAINTENANCE_MODE_STRATEGY]:e.metadata.labels[I["a"].VM_MAINTENANCE_MODE_STRATEGY]=this.maintenanceStrategy},parseDiskRows(e){var t,s,i,a,n,o,r,l,d,c,u,h,m,p,g,f;const y=[],b=[],N=[],E=[];if(e.forEach((e,t)=>{var s;const i=(null===(s=this.value.metadata)||void 0===s?void 0:s.name)||"";let a="";a=e.source===S["f"].ATTACH_VOLUME?e.volumeName:this.isClone||!this.hasCreateVolumes.includes(e.realName)?`${i}-${e.name}-${Object(v["p"])(5).toLowerCase()}`:e.realName;const n=this.parseDisk(e,t),o=this.parseVolume(e,a),r=this.parseVolumeClaimTemplate(e,a);y.push(n),b.push(o),N.push(a),e.source!==S["f"].CONTAINER&&E.push(r)}),this.secretName&&!this.needNewSecret||(this.secretName=this.generateSecretName(this.secretNamePrefix)),!y.find(e=>"cloudinitdisk"===e.name)&&(this.userData||this.networkData)&&!this.isWindows){y.push({name:"cloudinitdisk",disk:{bus:"virtio"}});const e=this.getUserData({osType:this.osType,installAgent:this.installAgent}),t={name:"cloudinitdisk",cloudInitNoCloud:{}};this.saveUserDataAsClearText?t.cloudInitNoCloud.userData=e:t.cloudInitNoCloud.secretRef={name:this.secretName},this.saveNetworkDataAsClearText?t.cloudInitNoCloud.networkData=this.networkScript:t.cloudInitNoCloud.networkDataSecretRef={name:this.secretName},b.push(t)}let T={...this.spec,runStrategy:this.runStrategy,template:{...this.spec.template,metadata:{...null===(t=this.spec)||void 0===t||null===(s=t.template)||void 0===s?void 0:s.metadata,annotations:{...null===(i=this.spec)||void 0===i||null===(a=i.template)||void 0===a||null===(n=a.metadata)||void 0===n?void 0:n.annotations,[I["a"].SSH_NAMES]:JSON.stringify(this.sshKey)},labels:{...null===(o=this.spec)||void 0===o||null===(r=o.template)||void 0===r||null===(l=r.metadata)||void 0===l?void 0:l.labels,[I["a"].VM_NAME]:null===(d=this.value)||void 0===d||null===(c=d.metadata)||void 0===c?void 0:c.name}},spec:{...null===(u=this.spec.template)||void 0===u?void 0:u.spec,domain:{...null===(h=this.spec.template)||void 0===h||null===(m=h.spec)||void 0===m?void 0:m.domain,devices:{...null===(p=this.spec.template)||void 0===p||null===(g=p.spec)||void 0===g||null===(f=g.domain)||void 0===f?void 0:f.devices,disks:y}},volumes:b}}};0===b.length&&delete T.template.spec.volumes,this.resource===A["b"].VM?(this.isSingle||(T=this.multiVMScheduler(T)),this.$set(this.value.metadata,"annotations",{...this.value.metadata.annotations,[I["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(E),[I["a"].NETWORK_IPS]:JSON.stringify(this.value.networkIps)}),this.$set(this.value.metadata,"labels",{...this.value.metadata.labels,[I["a"].CREATOR]:"harvester",[I["a"].OS]:this.osType}),this.$set(this.value,"spec",T),this.$set(this,"spec",T)):this.resource===A["b"].VM_VERSION&&(this.$set(this.value.spec.vm,"spec",T),this.$set(this.value.spec.vm.metadata,"annotations",{...this.value.spec.vm.metadata.annotations,[I["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(E)}),this.$set(this.value.spec.vm.metadata,"labels",{...this.value.spec.vm.metadata.labels,[I["a"].OS]:this.osType}),this.$set(this,"spec",T))},removeTrailingHyphen(e){while(e.endsWith("-"))e=e.slice(0,-1);return e},multiVMScheduler(e){var t,s,i,a,n;const o=this.removeTrailingHyphen(this.namePrefix);e.template.metadata.labels[I["a"].VM_NAME_PREFIX]=o;const r={weight:1,podAffinityTerm:{topologyKey:E["n"],labelSelector:{matchLabels:{[I["a"].VM_NAME_PREFIX]:o}}}};return{...e,template:{...e.template,spec:{...e.template.spec,affinity:{...e.template.spec.affinity,podAntiAffinity:{...null===(t=e.template.spec)||void 0===t||null===(s=t.affinity)||void 0===s?void 0:s.podAntiAffinity,preferredDuringSchedulingIgnoredDuringExecution:[...(null===(i=e.template.spec)||void 0===i||null===(a=i.affinity)||void 0===a||null===(n=a.podAntiAffinity)||void 0===n?void 0:n.preferredDuringSchedulingIgnoredDuringExecution)||[],r]}}}}}},parseNetworkRows(e){const t=[],s=[];e.forEach(e=>{const i=this.parseNetwork(e),a=this.parseInterface(e);t.push(i),s.push(a)});const i={...this.spec.template.spec,domain:{...this.spec.template.spec.domain,devices:{...this.spec.template.spec.domain.devices,interfaces:s}},networks:t};this.$set(this.spec.template,"spec",i)},parseAccessCredentials(){var e,t,s,i;const a=[],n={},o=JSON.parse((null===(e=this.spec)||void 0===e||null===(t=e.template)||void 0===t||null===(s=t.metadata)||void 0===s||null===(i=s.annotations)||void 0===i?void 0:i[I["a"].DYNAMIC_SSHKEYS_USERS])||"[]");for(const r of this.accessCredentials)this.needNewSecret&&(r.secretName=this.generateSecretName(this.secretNamePrefix)),r.source===S["a"].RESET_PWD&&(o.push(r.username),a.push({userPassword:{source:{secret:{secretName:r.secretName}},propagationMethod:{qemuGuestAgent:{}}}})),r.source===S["a"].INJECT_SSH&&(o.push(...r.users),n[r.secretName]=r.sshkeys,a.push({sshPublicKey:{source:{secret:{secretName:r.secretName}},propagationMethod:{qemuGuestAgent:{users:r.users}}}}));0===a.length&&this.spec.template.spec.accessCredentials?delete this.spec.template.spec.accessCredentials:this.spec.template.spec.accessCredentials=a,0!==o.length&&(this.spec.template.metadata.annotations[I["a"].DYNAMIC_SSHKEYS_USERS]=JSON.stringify(Array.from(new Set(o))),this.spec.template.metadata.annotations[I["a"].DYNAMIC_SSHKEYS_NAMES]=JSON.stringify(n))},getMaintenanceStrategyOptionLabel(e){return this.t("harvester.virtualMachine.maintenanceStrategy.options."+(e.label||e))},getInitUserData(e){const t=this.getMatchQGA(e.osType),s=n.a.dump(t);return"#cloud-config\n"+s},getUserData(e){try{let t=this.userScript?i["a"].parseDocument(this.userScript):i["a"].parseDocument({});const s=this.mergeSSHAuthorizedKeys(this.userScript);s.length>0?t.setIn(["ssh_authorized_keys"],s):i["a"].isCollection(t.getIn("ssh_authorized_keys"))&&t.deleteIn(["ssh_authorized_keys"]),t=e.installAgent?this.mergeQGA({userDataDoc:t,...e}):this.deleteQGA({userDataDoc:t,...e});const a=t.toString();if("{}\n"===a)return;return a}catch(t){return console.error("Error: Unable to parse yaml document",t),this.userScript}},updateSSHKey(e){this.$set(this,"sshKey",e)},updateCpuMemory(e,t){this.$set(this,"cpu",e),this.$set(this,"memory",t)},parseDisk(e,t){const s={name:e.name};return e.type===D?s.disk={bus:e.bus}:e.type===O&&(s.cdrom={bus:e.bus}),s.bootOrder=t+1,s},parseVolume(e,t){const s={name:e.name};return e.source===S["f"].CONTAINER?s.containerDisk={image:e.container}:e.source!==S["f"].IMAGE&&e.source!==S["f"].NEW&&e.source!==S["f"].ATTACH_VOLUME||(s.persistentVolumeClaim={claimName:t},e.hotpluggable&&(s.persistentVolumeClaim.hotpluggable=!0)),s},parseVolumeClaimTemplate(e,t){!String(e.size).includes("Gi")&&e.size&&(e.size=e.size+"Gi");const s={metadata:{name:t},spec:{accessModes:[e.accessMode],resources:{requests:{storage:e.size}},volumeMode:e.volumeMode}};switch(e.dataSource&&(s.spec.dataSource=e.dataSource),e.source){case S["f"].ATTACH_VOLUME:s.spec.storageClassName=e.storageClassName;break;case S["f"].NEW:s.spec.storageClassName=e.storageClassName;break;case S["f"].IMAGE:{const t=this.images.find(t=>e.image===t.id);t?(s.spec.storageClassName=t.storageClassName,s.metadata.annotations={[I["a"].IMAGE_ID]:t.id}):s.metadata.annotations={[I["a"].IMAGE_ID]:""};break}}return s},getSSHListValue(e){return e.map(e=>this.getSSHValue(e)).filter(e=>void 0!==e)},parseInterface(e){const t={},s=e.type;return t[s]={},e.macAddress&&(t.macAddress=e.macAddress),t.model=e.model,t.name=e.name,t},parseNetwork(e){const t={name:e.name};return e.isPod?t.pod={}:t.multus={networkName:e.networkName},t},updateUserData(e){this.userScript=e},updateNetworkData(e){this.networkScript=e},mergeSSHAuthorizedKeys(e){try{var t;const s=(null===(t=i["a"].parseDocument(e).get("ssh_authorized_keys"))||void 0===t?void 0:t.toJSON())||[],a=this.getSSHListValue(this.sshKey);return s.length?[...new Set([...a,...s])]:a}catch(s){return[]}},deleteYamlDocProp(e,t){try{var s,i;const a=null===(s=e.getIn([]))||void 0===s?void 0:s.items[0],n=null===a||void 0===a?void 0:a.key,o=!(null===n||void 0===n||null===(i=n.commentBefore)||void 0===i||!i.includes("cloud-config")),r=n.source===t[t.length-1];n&&o&&r||e.deleteIn(t)}catch(a){}},mergeQGA(e){const{osType:t,userDataDoc:s}=e,a=this.getMatchQGA(t),n=s.toString(),o=i["a"].parse(n);let r=(null===o||void 0===o?void 0:o.packages)||[],l=(null===o||void 0===o?void 0:o.runcmd)||[];if(s.setIn(["package_update"],!0),Array.isArray(r)?r.includes("qemu-guest-agent")||r.push("qemu-guest-agent"):r=T["a"].packages,Array.isArray(l)){let e=-1;const s=l.find(e=>Array.isArray(e)&&e.join("-")===a.runcmd[0].join("-")),i=l.find((s,i)=>!(!Array.isArray(s)||s.join("-")!==this.getSimilarRuncmd(t).join("-"))&&(e=i,!0));i?l[e]=a.runcmd[0]:s||l.push(a.runcmd[0])}else l=a.runcmd;return r.length>0?s.setIn(["packages"],r):(s.setIn(["packages"],[]),this.deleteYamlDocProp(s,["packages"]),this.deleteYamlDocProp(s,["package_update"])),l.length>0?s.setIn(["runcmd"],l):this.deleteYamlDocProp(s,["runcmd"]),s},deleteQGA(e){var t,s;const{osType:a,userDataDoc:n,deletePackage:o=!1}=e,r=(null===(t=this.$store.getters["harvester/byId"](b["e"],this.userDataTemplateId))||void 0===t||null===(s=t.data)||void 0===s?void 0:s.cloudInit)||"",l=n.toString(),d=i["a"].parse(l),c=(null===d||void 0===d?void 0:d.packages)||[],u=(null===d||void 0===d?void 0:d.runcmd)||[];if(Array.isArray(c)&&o){const e=this.convertToJson(r);for(let t=0;t<c.length;t++)"qemu-guest-agent"===c[t]&&(Array.isArray(null===e||void 0===e?void 0:e.packages)&&e.packages.includes("qemu-guest-agent")||c.splice(t,1))}if(Array.isArray(u)){const e=this.getMatchQGA(a);for(let t=0;t<u.length;t++)Array.isArray(u[t])&&u[t].join("-")===e.runcmd[0].join("-")&&u.splice(t,1)}return c.length>0?n.setIn(["packages"],c):(n.setIn(["packages"],[]),this.deleteYamlDocProp(n,["packages"]),this.deleteYamlDocProp(n,["package_update"])),u.length>0?n.setIn(["runcmd"],u):this.deleteYamlDocProp(n,["runcmd"]),n},generateSecretName(e){return e?`${e}-${Object(v["p"])(5).toLowerCase()}`:void 0},getOwnerReferencesFromVM(e){var t;const s=e.metadata.name,i=e.kind,a=this.resource===A["b"].VM?"kubevirt.io/v1":"harvesterhci.io/v1beta1",n=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.uid;return[{name:s,kind:i,uid:n,apiVersion:a}]},async saveSecret(e){if(null===e||void 0===e||!e.spec||!this.secretName||this.isWindows)return!0;let t=this.getSecret(e.spec);!t&&this.isEdit&&this.secretRef&&(t=this.secretRef),t&&!this.needNewSecret||(t=await this.$store.dispatch("harvester/create",{metadata:{name:this.secretName,namespace:this.value.metadata.namespace,labels:{[I["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:b["K"]}));try{t&&(this.saveUserDataAsClearText&&this.saveNetworkDataAsClearText||(t.setData("userdata",this.userData||""),t.setData("networkdata",this.networkScript||""),await t.save()))}catch(s){return Promise.reject(s)}},async saveAccessCredentials(e){if(null===e||void 0===e||!e.spec)return!0;const t=[];for(const i of this.accessCredentials){let s=i.secretRef;if(s&&!this.needNewSecret||(s=await this.$store.dispatch("harvester/create",{metadata:{name:i.secretName,namespace:e.metadata.namespace,labels:{[I["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:b["K"]})),i.source===S["a"].RESET_PWD&&s.setData(i.username,i.newPassword),i.source===S["a"].INJECT_SSH)for(const e of i.sshkeys){const t=(this.$store.getters["harvester/all"](A["b"].SSH)||[]).find(t=>t.id===e);s.setData(`${t.metadata.namespace}-${t.metadata.name}`,t.spec.publicKey)}t.push(s)}try{for(const e of t)await e.save()}catch(s){return Promise.reject(s)}},getAccessCredentialsValidation(){const e=[];for(let t=0;t<this.accessCredentials.length;t++){const s=this.accessCredentials[t],i=s.source;if(i===S["a"].RESET_PWD){if(!s.username){const t=this.t("harvester.virtualMachine.input.username"),s=this.t("validation.required",{key:t});e.push(s)}if(!s.newPassword){const t=this.t("harvester.virtualMachine.input.password"),s=this.t("validation.required",{key:t});e.push(s)}if(s.newPassword&&s.newPassword.length<6){const t=this.t("harvester.virtualMachine.input.password"),s=this.t("validation.number.min",{key:t,val:"6"});e.push(s)}}else{if(!s.users||0===s.users.length){const t=this.t("harvester.virtualMachine.input.username"),s=this.t("validation.required",{key:t});e.push(s)}if(!s.sshkeys||0===s.sshkeys.length){const t=this.t("harvester.virtualMachine.input.sshKeyValue"),s=this.t("validation.required",{key:t});e.push(s)}}if(e.length>0)break}return e},getHasCreatedVolumes(e){const t=[];return e.template.spec.volumes&&e.template.spec.volumes.forEach(e=>{var s;null!==e&&void 0!==e&&null!==(s=e.persistentVolumeClaim)&&void 0!==s&&s.claimName&&t.push(e.persistentVolumeClaim.claimName)}),t},handlerUSBTablet(e){var t;const s=this.isInstallUSBTablet(this.spec),i=(null===(t=this.spec.template.spec.domain.devices)||void 0===t?void 0:t.inputs)||[];if(e&&!s)i.length>0?i.push(T["b"][0]):Object.assign(this.spec.template.spec.domain.devices,{inputs:[T["b"][0]]});else if(!e){const e=i.findIndex(e=>r()(e,T["b"][0]));s&&1===i.length?this.$delete(this.spec.template.spec.domain.devices,"inputs"):s&&(i.splice(e,1),this.$set(this.spec.template.spec.domain.devices,"inputs",i))}},setBootMethod(e={efi:!1,secureBoot:!1}){if(e.efi&&e.secureBoot)Object(m["j"])(this.spec.template.spec.domain,"features.smm.enabled",!0),Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!0);else if(e.efi&&!e.secureBoot){try{this.$delete(this.spec.template.spec.domain.features.smm,"enabled");const e=0===Object.keys(this.spec.template.spec.domain.features.smm).length;e&&this.$delete(this.spec.template.spec.domain.features,"smm")}catch(t){}Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!1)}else this.$delete(this.spec.template.spec.domain,"firmware"),this.$delete(this.spec.template.spec.domain.features,"smm")},setCpuPinning(e){e?Object(m["j"])(this.spec.template.spec.domain.cpu,"dedicatedCpuPlacement",!0):this.$delete(this.spec.template.spec.domain.cpu,"dedicatedCpuPlacement")},setTPM(e){e?Object(m["j"])(this.spec.template.spec.domain.devices,"tpm",{}):this.$delete(this.spec.template.spec.domain.devices,"tpm")},deleteSSHFromUserData(e=[]){const t=this.getSSHFromUserData(this.userScript);e.map(e=>{const s=t.findIndex(t=>t===this.getSSHValue(e));s>=0&&t.splice(s,1)});const s=this.convertToJson(this.userScript);s.ssh_authorized_keys=t,0===t.length&&delete s.ssh_authorized_keys,d()(s)?this.$set(this,"userScript",void 0):this.$set(this,"userScript",n.a.dump(s)),this.refreshYamlEditor()},refreshYamlEditor(){this.$nextTick(()=>{var e;null===(e=this.$refs.yamlEditor)||void 0===e||e.updateValue()})},toggleAdvanced(){this.showAdvanced=!this.showAdvanced},updateAgent(e){e||(this.deletePackage=!0)},updateDataTemplateId(e,t){if("user"===e){const e=this.installAgent;this.userDataTemplateId=t,this.$nextTick(()=>{e&&(this.installAgent=e)})}},updateReserved(e={}){const{memory:t}=e;this.$set(this,"reservedMemory",t)},updateTerminationGracePeriodSeconds(e){this.$set(this,"terminationGracePeriodSeconds",e)}},watch:{diskRows:{handler(e,t){if(Array.isArray(e)){var s,i;const a=null===(s=e[0])||void 0===s?void 0:s.image,n=this.images.find(e=>a===e.id),o=null===n||void 0===n?void 0:n.imageOSType,r=null===(i=t[0])||void 0===i?void 0:i.image;this.isCreate&&r===a&&a&&(this.osType=o)}}},secretRef:{handler(e){e&&this.resource!==A["b"].BACKUP&&(this.secretName=null===e||void 0===e?void 0:e.metadata.name)},immediate:!0,deep:!0},isWindows(e){e&&(this.$set(this,"sshKey",[]),this.$set(this,"userScript",void 0),this.$set(this,"installAgent",!1))},installUSBTablet(e){this.handlerUSBTablet(e)},efiEnabled(e){this.setBootMethod({efi:e,secureBoot:this.secureBoot})},secureBoot(e){this.setBootMethod({efi:this.efiEnabled,secureBoot:e})},cpuPinning(e){this.setCpuPinning(e)},tpmEnabled(e){this.setTPM(e)},installAgent:{handler(e){if(this.deleteAgent){let t=this.getUserData({installAgent:e,osType:this.osType,deletePackage:this.deletePackage});if(e){const e=this.hasCloudConfigComment(t);e||(t="#cloud-config\n"+t)}this.$set(this,"userScript",t),this.refreshYamlEditor()}this.deleteAgent=!0,this.deletePackage=!1}},osType(e){const t=this.getUserData({installAgent:this.installAgent,osType:e});this.$set(this,"userScript",t),this.refreshYamlEditor()},userScript(e,t){const s=this.hasInstallAgent(e,this.osType,this.installAgent);s!==this.installAgent&&(this.deleteAgent=!1,this.installAgent=s)},sshKey(e,t){const s=u()(t,e);s.length&&this.isEdit&&this.deleteSSHFromUserData(s)}}}}}]);
//# sourceMappingURL=harvester-1.4.0.umd.min.detail~edit~formatters.js.map